<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dental Privacy & Confidentiality Learning Activity</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#532A8C',
                            light: '#9D8ABB',
                            green: '#7ABF49',
                            lightGreen: '#96BF78',
                            bg: '#F2F2F2',
                            accent: '#C3ACE8'
                        }
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F2F2F2;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .correct-anim {
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        /* Pulse animation for the listening button */
        .speaking {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(83, 42, 140, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(83, 42, 140, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(83, 42, 140, 0); }
        }
    </style>
</head>
<body class="text-gray-800 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-brand-dark text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <!-- Custom Dental Assistant / Nurse Icon -->
                <svg class="w-10 h-10 text-brand-green fill-current" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Head -->
                    <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
                    <!-- Shoulders -->
                    <path d="M4 20C4 16 8 14 12 14C16 14 20 16 20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <!-- Nurse Cap -->
                    <path d="M9 5L10 3H14L15 5" stroke="currentColor" stroke-width="2" fill="currentColor"/>
                    <!-- Cross on cap -->
                    <path d="M12 3V5 M11 4H13" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                
                <div>
                    <h1 class="text-xl font-bold leading-tight">Confidentiality & Reporting</h1>
                    <p class="text-xs text-brand-accent opacity-90">CHCCOM005 & CHCDIV001</p>
                </div>
            </div>
            <div class="hidden sm:block text-sm font-medium text-brand-lightGreen">
                The Guardian of Information
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-4xl mx-auto px-4 py-8 w-full space-y-12">

        <!-- Intro Section -->
        <section class="text-center space-y-4 fade-in">
            <h2 class="text-3xl font-bold text-brand-dark">Why It Matters</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                As a Dental Assistant, you are the guardian of a patient's personal information. 
                Complete the activities below to verify your understanding of your legal and ethical obligations.
            </p>
            <div class="flex justify-center items-center space-x-2 text-sm text-brand-dark bg-white inline-block px-4 py-2 rounded-full shadow-sm mx-auto">
                <i data-lucide="volume-2" class="w-4 h-4"></i>
                <span>Audio enabled: Click "Listen" on scenarios or interact with quizzes for sound.</span>
            </div>
        </section>

        <!-- Activity 1: Scenario Analysis -->
        <section id="scenarios" class="space-y-6">
            <div class="flex items-center space-x-2 border-b-2 border-brand-light pb-2">
                <div class="bg-brand-dark text-white p-2 rounded-lg">
                    <i data-lucide="users" class="w-5 h-5"></i>
                </div>
                <h3 class="text-2xl font-bold text-brand-dark">Part 1: Scenario Analysis</h3>
            </div>
            <p class="text-gray-600 italic">Read the scenarios (or click Listen) and reflect on the privacy breaches.</p>

            <div class="grid md:grid-cols-1 gap-6">
                
                <!-- Scenario A -->
                <div class="glass-panel p-6 rounded-xl shadow-md border-l-4 border-brand-green hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center space-x-2">
                            <h4 class="font-bold text-lg text-brand-dark">Scenario A: The Busy Front Desk</h4>
                            <span class="bg-brand-bg text-brand-dark text-xs px-2 py-1 rounded font-semibold">Reception</span>
                        </div>
                        <button onclick="readText('Scenario A. You are working at the reception desk. You shout out, Hi Mr. Jones! Did that cold sore cream work? meanwhile, leaving Mrs. Smith\'s file open on the counter.', this)" class="text-brand-dark hover:text-brand-green p-1 rounded-full hover:bg-gray-100 transition-colors" title="Listen to Scenario">
                            <i data-lucide="play-circle" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <p class="text-gray-700 mb-4 text-sm bg-blue-50 p-3 rounded border border-blue-100">
                        You shout out, "Hi Mr. Jones! Did that cold sore cream work?" meanwhile, leaving Mrs. Smith's file open on the counter.
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold text-sm text-brand-dark mb-1">1. Identify two specific privacy breaches.</p>
                            <textarea class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-brand-lightGreen focus:outline-none text-sm" rows="2" placeholder="Type your answer here..."></textarea>
                        </div>
                        <button onclick="toggleAnswer('ans-a')" class="text-sm text-brand-dark font-semibold hover:text-brand-green flex items-center transition-colors">
                            <i data-lucide="eye" class="w-4 h-4 mr-1"></i> Reveal Model Answer
                        </button>
                        <div id="ans-a" class="hidden bg-green-50 p-4 rounded-lg border border-brand-lightGreen text-sm text-gray-800 animate-fade-in">
                            <strong>Correct Analysis:</strong> <br>
                            1. Yelling out sensitive medical questions (the cold sore).<br>
                            2. Leaving patient files visible on the counter.<br>
                            <em class="text-brand-dark mt-2 block">Fix: Keep voices low and screens/files hidden from view.</em>
                        </div>
                    </div>
                </div>

                <!-- Scenario B -->
                <div class="glass-panel p-6 rounded-xl shadow-md border-l-4 border-brand-dark hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center space-x-2">
                            <h4 class="font-bold text-lg text-brand-dark">Scenario B: The Concerned Spouse</h4>
                            <span class="bg-brand-bg text-brand-dark text-xs px-2 py-1 rounded font-semibold">Family</span>
                        </div>
                         <button onclick="readText('Scenario B. Mrs. Lee\'s husband calls and says: I am the head of the household. Email me Mrs. Lee\'s X-rays immediately.', this)" class="text-brand-dark hover:text-brand-green p-1 rounded-full hover:bg-gray-100 transition-colors" title="Listen to Scenario">
                            <i data-lucide="play-circle" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <p class="text-gray-700 mb-4 text-sm bg-blue-50 p-3 rounded border border-blue-100">
                        Mrs. Lee's husband calls: "I am the head of the household. Email me Mrs. Lee's X-rays immediately."
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold text-sm text-brand-dark mb-1">1. Can you send the records without Mrs. Lee's consent?</p>
                            <div class="flex space-x-4 mt-2">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="scenario_b" class="accent-brand-dark"> <span>Yes, he pays the bills.</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="scenario_b" class="accent-brand-dark"> <span>No, never without consent.</span>
                                </label>
                            </div>
                        </div>
                        <button onclick="toggleAnswer('ans-b')" class="text-sm text-brand-dark font-semibold hover:text-brand-green flex items-center transition-colors">
                            <i data-lucide="eye" class="w-4 h-4 mr-1"></i> Reveal Model Answer
                        </button>
                        <div id="ans-b" class="hidden bg-green-50 p-4 rounded-lg border border-brand-lightGreen text-sm text-gray-800 animate-fade-in">
                            <strong>Correct Analysis:</strong> <br>
                            <strong>No.</strong> We cannot give an adult's info to a spouse without permission, regardless of who pays or cultural hierarchy. Australian Privacy Law requires individual consent.
                        </div>
                    </div>
                </div>

                <!-- Scenario C -->
                <div class="glass-panel p-6 rounded-xl shadow-md border-l-4 border-brand-accent hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center space-x-2">
                            <h4 class="font-bold text-lg text-brand-dark">Scenario C: The Interpreter</h4>
                            <span class="bg-brand-bg text-brand-dark text-xs px-2 py-1 rounded font-semibold">Diversity</span>
                        </div>
                         <button onclick="readText('Scenario C. A patient arrives with a professional interpreter to help communicate. What must the interpreter do before starting?', this)" class="text-brand-dark hover:text-brand-green p-1 rounded-full hover:bg-gray-100 transition-colors" title="Listen to Scenario">
                            <i data-lucide="play-circle" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <p class="text-gray-700 mb-4 text-sm bg-blue-50 p-3 rounded border border-blue-100">
                        A patient arrives with a professional interpreter to help communicate.
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold text-sm text-brand-dark mb-1">What must the interpreter do before starting?</p>
                            <select id="sel-c" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-brand-lightGreen focus:outline-none text-sm bg-white">
                                <option>Select an action...</option>
                                <option>Show their driver's license</option>
                                <option>Sign a confidentiality agreement</option>
                                <option>Pay a deposit</option>
                            </select>
                        </div>
                        <button onclick="checkSelectC()" class="text-sm text-brand-dark font-semibold hover:text-brand-green flex items-center transition-colors">
                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Check Answer
                        </button>
                        <div id="ans-c" class="hidden bg-green-50 p-4 rounded-lg border border-brand-lightGreen text-sm text-gray-800 animate-fade-in">
                            <strong>Correct!</strong> Interpreters must sign a confidentiality agreement to ensure they are bound by the same privacy laws as the staff.
                        </div>
                         <div id="ans-c-err" class="hidden bg-red-50 p-4 rounded-lg border border-red-300 text-sm text-red-800 animate-fade-in">
                            Try again. Think about legal protection of information.
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Activity 2: Matching -->
        <section class="space-y-6">
            <div class="flex items-center space-x-2 border-b-2 border-brand-light pb-2">
                <div class="bg-brand-dark text-white p-2 rounded-lg">
                    <i data-lucide="arrow-left-right" class="w-5 h-5"></i>
                </div>
                <h3 class="text-2xl font-bold text-brand-dark">Part 2: Privacy vs. Confidentiality</h3>
            </div>
            <p class="text-gray-600">Click the button that matches the definition displayed.</p>

            <div class="bg-white p-8 rounded-xl shadow-lg text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-brand-light"></div>
                
                <div id="match-container" class="transition-all duration-300">
                    <p class="text-sm uppercase tracking-widest text-brand-light mb-2 font-bold">Definition</p>
                    <h4 id="def-text" class="text-xl md:text-2xl font-bold text-brand-dark mb-8 min-h-[4rem] flex items-center justify-center">
                        "The patient's right to control their own personal information."
                    </h4>

                    <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                        <button onclick="checkMatch('Privacy')" class="py-4 px-6 rounded-lg border-2 border-brand-dark text-brand-dark font-bold hover:bg-brand-dark hover:text-white transition-all transform hover:-translate-y-1">
                            Privacy
                        </button>
                        <button onclick="checkMatch('Confidentiality')" class="py-4 px-6 rounded-lg border-2 border-brand-green text-brand-green font-bold hover:bg-brand-green hover:text-white transition-all transform hover:-translate-y-1">
                            Confidentiality
                        </button>
                    </div>
                </div>
                
                <div id="match-feedback" class="hidden mt-6 font-bold text-lg"></div>
            </div>
        </section>

        <!-- Activity 3: True or False -->
        <section class="space-y-6">
            <div class="flex items-center space-x-2 border-b-2 border-brand-light pb-2">
                <div class="bg-brand-dark text-white p-2 rounded-lg">
                    <i data-lucide="check-square" class="w-5 h-5"></i>
                </div>
                <h3 class="text-2xl font-bold text-brand-dark">Part 3: Compliance Checklist</h3>
            </div>

            <div class="space-y-4">
                <!-- Q1 -->
                <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-brand-lightGreen">
                    <p class="font-medium text-gray-800 mb-3">1. If a patient asks for a copy of their own X-rays, we are legally required to give it to them.</p>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-green transition-colors">
                                <input type="radio" name="q1" value="true" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-green">
                            </div>
                            <span class="text-sm">True</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-dark transition-colors">
                                <input type="radio" name="q1" value="false" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-dark">
                            </div>
                            <span class="text-sm">False</span>
                        </label>
                    </div>
                </div>

                <!-- Q2 -->
                <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-brand-lightGreen">
                    <p class="font-medium text-gray-800 mb-3">2. We can use patient email addresses for marketing purposes without asking, as long as they are already patients.</p>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-green transition-colors">
                                <input type="radio" name="q2" value="true" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-green">
                            </div>
                            <span class="text-sm">True</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-dark transition-colors">
                                <input type="radio" name="q2" value="false" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-dark">
                            </div>
                            <span class="text-sm">False</span>
                        </label>
                    </div>
                </div>

                <!-- Q3 -->
                <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-brand-lightGreen">
                    <p class="font-medium text-gray-800 mb-3">3. The "Golden Rule" says: If it isn't necessary for treatment, don't collect it.</p>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-green transition-colors">
                                <input type="radio" name="q3" value="true" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-green">
                            </div>
                            <span class="text-sm">True</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-dark transition-colors">
                                <input type="radio" name="q3" value="false" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-dark">
                            </div>
                            <span class="text-sm">False</span>
                        </label>
                    </div>
                </div>

                 <!-- Q4 -->
                 <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-brand-lightGreen">
                    <p class="font-medium text-gray-800 mb-3">4. Breaching privacy is just "bad manners," but it is not illegal.</p>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-green transition-colors">
                                <input type="radio" name="q4" value="true" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-green">
                            </div>
                            <span class="text-sm">True</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center group-hover:border-brand-dark transition-colors">
                                <input type="radio" name="q4" value="false" class="appearance-none w-3 h-3 rounded-full bg-transparent checked:bg-brand-dark">
                            </div>
                            <span class="text-sm">False</span>
                        </label>
                    </div>
                </div>

                <div class="pt-4">
                    <button onclick="checkQuiz()" class="bg-brand-dark text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-brand-green transition-colors w-full sm:w-auto">
                        Check My Compliance
                    </button>
                    <div id="quiz-result" class="hidden mt-4 p-4 rounded-lg text-center font-bold"></div>
                </div>
            </div>
        </section>

        <!-- Activity 4: WHS & Safety (New Section) -->
        <section class="space-y-6 pb-12">
            <div class="flex items-center space-x-2 border-b-2 border-brand-light pb-2">
                <div class="bg-brand-dark text-white p-2 rounded-lg">
                    <!-- Alarm Icon for WHS -->
                    <i data-lucide="siren" class="w-5 h-5"></i>
                </div>
                <h3 class="text-2xl font-bold text-brand-dark">Part 4: WHS & Safety Reporting</h3>
            </div>
            
            <div class="glass-panel p-6 rounded-xl shadow-md border-l-4 border-red-500 hover:shadow-lg transition-shadow">
                 <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center space-x-2">
                        <h4 class="font-bold text-lg text-brand-dark">Scenario D: The Slippery Floor</h4>
                        <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded font-semibold">Safety Hazard</span>
                    </div>
                     <button onclick="readText('Scenario D. You notice a puddle of water in the waiting room near the electrical cords. What is your immediate WHS obligation?', this)" class="text-brand-dark hover:text-brand-green p-1 rounded-full hover:bg-gray-100 transition-colors" title="Listen to Scenario">
                        <i data-lucide="play-circle" class="w-6 h-6"></i>
                    </button>
                </div>
                <p class="text-gray-700 mb-4 text-sm bg-red-50 p-3 rounded border border-red-100">
                    You notice a puddle of water in the waiting room near the electrical cords.
                </p>
                
                <div class="space-y-4">
                    <div>
                        <p class="font-semibold text-sm text-brand-dark mb-1">What is your immediate WHS obligation?</p>
                        <div class="flex flex-col space-y-2 mt-2">
                            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50">
                                <input type="radio" name="scenario_whs" class="accent-brand-dark" value="wrong"> <span>Wait for the cleaners to arrive tonight.</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50">
                                <input type="radio" name="scenario_whs" class="accent-brand-dark" value="correct"> <span>Report it immediately and place a warning sign/cone.</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50">
                                <input type="radio" name="scenario_whs" class="accent-brand-dark" value="wrong"> <span>Ignore it, it's not in the dental surgery room.</span>
                            </label>
                        </div>
                    </div>
                    <button onclick="checkWHS()" class="text-sm text-brand-dark font-semibold hover:text-brand-green flex items-center transition-colors">
                        <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Check Safety Response
                    </button>
                    <div id="ans-whs" class="hidden p-4 rounded-lg border text-sm text-gray-800 animate-fade-in"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-brand-dark text-brand-accent py-6 mt-auto">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <p class="text-sm">&copy; Dental Practice Training. Keep Patient Data Safe.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Initialize Icons ensuring DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            if (window.lucide) {
                lucide.createIcons();
            }
        });

        /* --- AUDIO SYSTEM --- */
        let audioCtx;

        // 1. Sound Effects (Synth)
        // Initialize AudioContext lazily on user interaction
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playTone(freq, type, duration) {
            // Ensure audio context is ready
            initAudio();

            if (audioCtx) {
                const osc = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();

                osc.type = type; // 'sine', 'square', 'sawtooth', 'triangle'
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

                osc.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            }
        }

        function playSuccess() {
            // High ping
            playTone(600, 'sine', 0.1);
            setTimeout(() => playTone(800, 'sine', 0.2), 100);
        }

        function playError() {
            // Low buzz
            playTone(200, 'sawtooth', 0.3);
        }

        // 2. Text to Speech
        function readText(text, btn) {
            // Stop any current speech
            window.speechSynthesis.cancel();
            
            // Create utterance
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-AU'; // Prefer Australian English if available
            utterance.rate = 1.0;
            utterance.pitch = 1.0;

            // Visual feedback
            if(btn) {
                btn.classList.add('speaking');
                // Replace icon with stop
                btn.innerHTML = '<i data-lucide="stop-circle" class="w-6 h-6"></i>';
                lucide.createIcons();
                
                // Add click handler to stop
                btn.onclick = () => {
                    window.speechSynthesis.cancel();
                };
            }

            utterance.onend = () => {
                if(btn) {
                    btn.classList.remove('speaking');
                    btn.innerHTML = '<i data-lucide="play-circle" class="w-6 h-6"></i>';
                    lucide.createIcons();
                    // Reset click handler
                    btn.onclick = () => readText(text, btn);
                }
            };

            window.speechSynthesis.speak(utterance);
        }


        // SCENARIOS
        function toggleAnswer(id) {
            const el = document.getElementById(id);
            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
                // Optional: small click sound
            } else {
                el.classList.add('hidden');
            }
        }

        function checkSelectC() {
            const val = document.getElementById('sel-c').value;
            const success = document.getElementById('ans-c');
            const error = document.getElementById('ans-c-err');
            
            success.classList.add('hidden');
            error.classList.add('hidden');

            if (val === "Sign a confidentiality agreement") {
                success.classList.remove('hidden');
                playSuccess();
            } else {
                error.classList.remove('hidden');
                playError();
            }
        }

        // MATCHING GAME
        const definitions = [
            { text: "The patient's right to control their own personal information.", type: "Privacy" },
            { text: "Your duty to protect that information once it is shared.", type: "Confidentiality" },
            { text: "The 'Golden Rule': If it isn't necessary, don't collect it.", type: "Privacy" },
            { text: "Ensuring an interpreter signs a non-disclosure agreement.", type: "Confidentiality" }
        ];
        
        let currentDefIndex = 0;

        function checkMatch(selectedType) {
            const feedback = document.getElementById('match-feedback');
            const currentDef = definitions[currentDefIndex];
            
            if (selectedType === currentDef.type) {
                feedback.textContent = "Correct! Well done.";
                feedback.className = "mt-6 font-bold text-lg text-brand-green animate-pulse";
                playSuccess();
                
                // Move to next after short delay
                setTimeout(() => {
                    feedback.textContent = "";
                    currentDefIndex++;
                    if (currentDefIndex < definitions.length) {
                        document.getElementById('def-text').textContent = `"${definitions[currentDefIndex].text}"`;
                    } else {
                        // Reset
                        currentDefIndex = 0;
                        document.getElementById('def-text').innerHTML = "<span class='text-brand-green'>All definitions matched!</span> <br> <span class='text-sm font-normal text-gray-500'>Starting over...</span>";
                        setTimeout(() => {
                            document.getElementById('def-text').textContent = `"${definitions[0].text}"`;
                        }, 2000);
                    }
                }, 1000);

            } else {
                feedback.textContent = "Incorrect. Try again.";
                feedback.className = "mt-6 font-bold text-lg text-red-500";
                playError();
            }
            feedback.classList.remove('hidden');
        }

        // QUIZ
        function checkQuiz() {
            let score = 0;
            const total = 4;
            
            // Answers: 1=True, 2=False, 3=True, 4=False
            const q1 = document.querySelector('input[name="q1"]:checked')?.value;
            const q2 = document.querySelector('input[name="q2"]:checked')?.value;
            const q3 = document.querySelector('input[name="q3"]:checked')?.value;
            const q4 = document.querySelector('input[name="q4"]:checked')?.value;

            if (q1 === "true") score++;
            if (q2 === "false") score++;
            if (q3 === "true") score++;
            if (q4 === "false") score++;

            const resultDiv = document.getElementById('quiz-result');
            resultDiv.classList.remove('hidden');
            
            if (score === total) {
                resultDiv.className = "mt-4 p-4 rounded-lg text-center font-bold bg-brand-green text-white shadow-lg";
                resultDiv.innerHTML = `Perfect Score! ${score}/${total} <br> <span class="text-sm font-normal">You are a Guardian of Information!</span>`;
                playSuccess();
            } else {
                resultDiv.className = "mt-4 p-4 rounded-lg text-center font-bold bg-brand-light text-brand-dark";
                resultDiv.innerHTML = `You got ${score}/${total}. <br> <span class="text-sm font-normal">Review the scenarios and try again to ensure full compliance.</span>`;
                playError();
            }
        }

        // WHS CHECK
        function checkWHS() {
            const val = document.querySelector('input[name="scenario_whs"]:checked')?.value;
            const result = document.getElementById('ans-whs');
            
            if (!val) return;

            result.classList.remove('hidden');
            result.classList.remove('bg-green-50', 'border-brand-lightGreen', 'bg-red-50', 'border-red-300');

            if (val === 'correct') {
                result.classList.add('bg-green-50', 'border', 'border-brand-lightGreen');
                result.innerHTML = "<strong>Correct!</strong> Under WHS laws, you must address immediate hazards to prevent injury.";
                playSuccess();
            } else {
                result.classList.add('bg-red-50', 'border', 'border-red-300');
                result.innerHTML = "<strong>Incorrect.</strong> Ignoring hazards can lead to serious injury and liability. Always report and secure the area.";
                playError();
            }
        }
    </script>
</body>
</html>
